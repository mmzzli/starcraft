import{P as a}from"../vant/vant.819e26c8.js";import{_ as s}from"../HeaderTitle/HeaderTitle.41d7b1f9.js";import{i as t}from"../img23/img23.ed3afe21.js";import{i as e}from"../img24/img24.ed6b89f9.js";import{i as o}from"../img32/img32.2d4b9acf.js";import{i}from"../img37/img37.14b4b250.js";import{u as l,a as r}from"../vue-router/vue-router.6a5eb8ba.js";import{u as c}from"../vuex/vuex.adf06551.js";import{t as n,c as u,f as m,u as p,e as v,g as h,k as b}from"../starcraft-sdk/starcraft-sdk.b9fffec7.js";import{k as g,c as j,r as y,d,e as w,A as f,j as k,M as T,u as S,N as C,x,O as $,F as B,B as F,L as _,g as L,C as P,P as O,Q as U,R as q}from"../@vue/@vue.f0ed93ab.js";import{_ as E}from"../vue-count-to/vue-count-to.7851cffd.js";import"../@vant/@vant.0d6b19bc.js";import"../starcraft-core/starcraft-core.a7e8a7b2.js";import"../@ethersproject/@ethersproject.82fce948.js";import"../bn.js/bn.js.022a57fe.js";import"../aes-js/aes-js.52245d71.js";import"../hash.js/hash.js.951de082.js";import"../minimalistic-assert/minimalistic-assert.62310433.js";import"../inherits/inherits.e883a70c.js";import"../bech32/bech32.0c6cc0e9.js";import"../js-sha3/js-sha3.ce966f76.js";import"../ethers/ethers.7357afd8.js";import"../@apollo/@apollo.167459d8.js";import"../tslib/tslib.cdb03bbf.js";import"../optimism/optimism.dbbdffb5.js";import"../@wry/@wry.ac881673.js";import"../ts-invariant/ts-invariant.73996d61.js";import"../graphql/graphql.c449efb6.js";import"../zen-observable-ts/zen-observable-ts.11549e90.js";import"../symbol-observable/symbol-observable.efed2817.js";import"../graphql-tag/graphql-tag.47c56ce3.js";const A=a=>(U("data-v-7847f5e0"),a=a(),q(),a),I={class:"container"},N={class:"container2"},z=["src"],H={class:"tabs_content"},R={class:"tabs"},V=["src"],J=["src"],M=A((()=>T("button",{class:"btn"},"Pay 100 SCT + old Facil",-1))),Q=A((()=>T("div",{class:"des"}," You can pay 2000 SCT tokens to buy a planetary facility lucky box, open the lucky box to have a 100% chance to get the equipment. ",-1))),X={class:"popupbox1"},Y=["src"],D={class:"popup_BagsItem"},G=["src"],K={class:"attr"},W=["src"],Z={class:"title2"},aa=A((()=>T("span",null,"Energy",-1))),sa={class:"progress2"},ta=E(g({__name:"Facility",setup(g){const{proxy:U}=L(),q=c(),E=l();r();const A=j((()=>q.state.walletAccount)),ta=y(1),ea=y(!1),oa=y(!1),ia=y(0),la=y(0),ra=y(0),ca=y(!0),na=y(""),ua=y("");let ma=d({});w((()=>{ga(),ja(),A.value&&pa()}));const pa=async()=>{ra.value=await U.$walletUtils.getBalance(n().SCT),ca.value=await U.$walletUtils.checkApprove(n().SCT,u().SCFBox,ra.value)},va=async()=>{U.$showLoadingToast({});try{const a=await v(n().SCT).connect(h()).approve(u().SCFBox,p.parseUnits(1e10.toString()));await a.wait(),pa(),U.$showSuccessToast()}catch(a){U.$closeToast()}},ha=async()=>{if(!A.value)return U.$showToast("Please connect wallet");if(ia.value>ra.value)return U.$showToast("Insufficient balance");if(la.value){U.$showLoadingToast({});try{const a=await m().connect(h()).draw(0,1);await a.wait(),U.$showSuccessToast(),ba()}catch(a){U.$closeToast()}}},ba=async()=>{U.$showLoadingToast({});try{const a=(await b().tokensOfOwnerBySize(A.value,0,1e3))[0].map((a=>Number(a))),s=a[a.length-1],t=(await b().tokenURI(s)).split(",")[1],e=atob(t),o=JSON.parse(e);o.attributes=o.attributes.reduce(((a,s)=>(a[s.trait_type]=s.value,a)),{}),na.value=o.name,ua.value=o.image,ma=o.attributes,oa.value=!0,U.$closeToast()}catch(a){U.$showFailToast("Error")}},ga=()=>{m().boxPrice(0).then((a=>{ia.value=U.$utils.utilFormat(p.formatEther(a))})).catch((a=>{}))},ja=()=>{m().getBoxLeftSupply(0).then((a=>{la.value=Number(a)})).catch((a=>{}))},ya=()=>{oa.value=!1},da=()=>{E.push("/Bags")};return(l,r)=>{const c=s,n=a;return P(),f("section",I,[k(c,{headTitle:"Facility Lucky Box"}),T("div",N,[T("img",{class:"box",src:S(t),alt:""},null,8,z),T("div",H,[T("div",R,[T("div",{class:C({active:1==ta.value}),onClick:r[0]||(r[0]=a=>{return s=1,void(ta.value=s);var s})},[x(" Pay with SCT "),2==ta.value?(P(),f("img",{key:0,class:"img1",src:S(e),alt:""},null,8,V)):$("",!0)],2),T("div",{class:C({active:2==ta.value})},[1==ta.value?(P(),f("img",{key:0,class:"img2",src:S(e),alt:""},null,8,J)):$("",!0)],2)]),1==ta.value?(P(),f(B,{key:0},[ca.value?(P(),f("button",{key:0,class:"btn",onClick:ha},F(ia.value)+" SCT for 1 Planet Facility Lucky BOX ",1)):(P(),f("button",{key:1,class:"btn",onClick:va},"Approve SCT"))],64)):$("",!0),2==ta.value?(P(),f(B,{key:1},[T("button",{class:"btn",onClick:r[1]||(r[1]=a=>ea.value=!0)},"Select Facility"),M],64)):$("",!0),Q])]),k(n,{show:oa.value,"onUpdate:show":r[2]||(r[2]=a=>oa.value=a),style:{background:"transparent"}},{default:_((()=>[T("div",X,[T("img",{class:"closebtn",src:S(o),alt:"",onClick:ya},null,8,Y),T("div",D,[T("img",{src:ua.value,alt:""},null,8,G),T("p",null,F(na.value),1),T("div",K,[T("img",{src:S(i),alt:""},null,8,W),T("div",null,[T("div",Z,[aa,x(),T("span",null,F(S(ma).Energy),1)]),T("div",sa,[(P(),f(B,null,O(12,((a,s)=>T("i",{key:s,class:C({active:s+1<=S(ma).Energy})},null,2))),64))])])]),T("button",{class:"btn2",onClick:da},"View in Bags")])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-7847f5e0"]]);export{ta as default};
